============================= test session starts ==============================
platform darwin -- Python 3.9.6, pytest-8.4.2, pluggy-1.6.0 -- /Library/Developer/CommandLineTools/usr/bin/python3
cachedir: .pytest_cache
rootdir: /Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency
configfile: pyproject.toml
plugins: anyio-4.11.0, cov-7.0.0
collecting ... collected 53 items

tests/test_data/test_db.py::TestDatabaseManagerInit::test_init_creates_directory_and_file PASSED [  1%]
tests/test_data/test_db.py::TestDatabaseManagerInit::test_init_with_string_path PASSED [  3%]
tests/test_data/test_db.py::TestDatabaseManagerInit::test_init_with_path_object PASSED [  5%]
tests/test_data/test_db.py::TestDatabaseManagerInit::test_init_uses_env_var_when_no_path PASSED [  7%]
tests/test_data/test_db.py::TestDatabaseManagerInit::test_init_uses_default_when_no_env PASSED [  9%]
tests/test_data/test_db.py::TestDatabaseManagerSingleton::test_singleton_returns_same_instance PASSED [ 11%]
tests/test_data/test_db.py::TestDatabaseManagerSingleton::test_singleton_ignores_subsequent_paths PASSED [ 13%]
tests/test_data/test_db.py::TestDatabaseManagerSingleton::test_reset_allows_new_instance PASSED [ 15%]
tests/test_data/test_db.py::TestConnectionContextManager::test_connection_context_manager_basic PASSED [ 16%]
tests/test_data/test_db.py::TestConnectionContextManager::test_connection_context_manager_persists_data PASSED [ 18%]
tests/test_data/test_db.py::TestConnectionContextManager::test_connection_context_manager_reraises_exception PASSED [ 20%]
tests/test_data/test_db.py::TestConnectionContextManager::test_connection_reuses_thread_local_connection PASSED [ 22%]
tests/test_data/test_db.py::TestExecuteMethod::test_execute_create_table PASSED [ 24%]
tests/test_data/test_db.py::TestExecuteMethod::test_execute_insert_without_params PASSED [ 26%]
tests/test_data/test_db.py::TestExecuteMethod::test_execute_insert_with_params PASSED [ 28%]
tests/test_data/test_db.py::TestExecuteMethod::test_execute_returns_relation FAILED [ 30%]
tests/test_data/test_db.py::TestExecuteMethod::test_execute_with_none_params FAILED [ 32%]
tests/test_data/test_db.py::TestFetchoneMethod::test_fetchone_returns_tuple PASSED [ 33%]
tests/test_data/test_db.py::TestFetchoneMethod::test_fetchone_returns_none_for_empty_result PASSED [ 35%]
tests/test_data/test_db.py::TestFetchoneMethod::test_fetchone_with_params PASSED [ 37%]
tests/test_data/test_db.py::TestFetchoneMethod::test_fetchone_with_date_types PASSED [ 39%]
tests/test_data/test_db.py::TestFetchallMethod::test_fetchall_returns_list_of_tuples PASSED [ 41%]
tests/test_data/test_db.py::TestFetchallMethod::test_fetchall_returns_empty_list_for_no_results PASSED [ 43%]
tests/test_data/test_db.py::TestFetchallMethod::test_fetchall_with_params PASSED [ 45%]
tests/test_data/test_db.py::TestFetchallMethod::test_fetchall_large_result_set PASSED [ 47%]
tests/test_data/test_db.py::TestFetchdfMethod::test_fetchdf_returns_dataframe PASSED [ 49%]
tests/test_data/test_db.py::TestFetchdfMethod::test_fetchdf_empty_result PASSED [ 50%]
tests/test_data/test_db.py::TestFetchdfMethod::test_fetchdf_preserves_column_types PASSED [ 52%]
tests/test_data/test_db.py::TestFetchdfMethod::test_fetchdf_with_params PASSED [ 54%]
tests/test_data/test_db.py::TestFetchdfMethod::test_fetchdf_with_aggregation PASSED [ 56%]
tests/test_data/test_db.py::TestCloseMethod::test_close_closes_connection PASSED [ 58%]
tests/test_data/test_db.py::TestCloseMethod::test_close_idempotent PASSED [ 60%]
tests/test_data/test_db.py::TestThreadSafety::test_concurrent_reads PASSED [ 62%]
tests/test_data/test_db.py::TestThreadSafety::test_concurrent_writes PASSED [ 64%]
tests/test_data/test_db.py::TestThreadSafety::test_thread_pool_executor PASSED [ 66%]
tests/test_data/test_db.py::TestGetDB::test_get_db_returns_database_manager FAILED [ 67%]
tests/test_data/test_db.py::TestGetDB::test_get_db_singleton FAILED      [ 69%]
tests/test_data/test_db.py::TestGetDB::test_get_db_with_explicit_path FAILED [ 71%]
tests/test_data/test_db.py::TestGetDB::test_get_db_with_env_var FAILED   [ 73%]
tests/test_data/test_db.py::TestSchemaIntegration::test_create_tables FAILED [ 75%]
tests/test_data/test_db.py::TestSchemaIntegration::test_verify_schema FAILED [ 77%]
tests/test_data/test_db.py::TestSchemaIntegration::test_get_table_counts FAILED [ 79%]
tests/test_data/test_db.py::TestSchemaIntegration::test_drop_all_tables FAILED [ 81%]
tests/test_data/test_db.py::TestEdgeCases::test_query_with_special_characters PASSED [ 83%]
tests/test_data/test_db.py::TestEdgeCases::test_null_values PASSED       [ 84%]
tests/test_data/test_db.py::TestEdgeCases::test_large_decimal_precision PASSED [ 86%]
tests/test_data/test_db.py::TestEdgeCases::test_empty_string_vs_null PASSED [ 88%]
tests/test_data/test_db.py::TestEdgeCases::test_unicode_characters PASSED [ 90%]
tests/test_data/test_db.py::TestEdgeCases::test_timestamp_handling PASSED [ 92%]
tests/test_data/test_db.py::TestComplexQueries::test_join_query PASSED   [ 94%]
tests/test_data/test_db.py::TestComplexQueries::test_subquery PASSED     [ 96%]
tests/test_data/test_db.py::TestComplexQueries::test_window_function PASSED [ 98%]
tests/test_data/test_db.py::TestComplexQueries::test_cte_query PASSED    [100%]

=================================== FAILURES ===================================
/Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency/tests/test_data/test_db.py:315: assert 0 == 3
/Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency/tests/test_data/test_db.py:327: TypeError: 'NoneType' object is not subscriptable
/Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency/hrp/data/db.py:293: TypeError: __new__() takes from 1 to 2 positional arguments but 3 were given
/Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency/hrp/data/db.py:293: TypeError: __new__() takes from 1 to 2 positional arguments but 3 were given
/Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency/hrp/data/db.py:293: TypeError: __new__() takes from 1 to 2 positional arguments but 3 were given
/Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency/hrp/data/db.py:293: TypeError: __new__() takes from 1 to 2 positional arguments but 3 were given
/Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency/hrp/data/schema.py:147: TypeError: unsupported operand type(s) for |: 'type' and 'NoneType'
/Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency/hrp/data/schema.py:147: TypeError: unsupported operand type(s) for |: 'type' and 'NoneType'
/Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency/hrp/data/schema.py:147: TypeError: unsupported operand type(s) for |: 'type' and 'NoneType'
/Users/fer/Documents/GitHub/HRP/.auto-claude/worktrees/tasks/007-duckdb-connection-pooling-concurrency/hrp/data/schema.py:147: TypeError: unsupported operand type(s) for |: 'type' and 'NoneType'
================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.9.6-final-0 ________________

Name                                  Stmts   Miss  Cover   Missing
-------------------------------------------------------------------
hrp/__init__.py                           2      0   100%
hrp/agents/__init__.py                    0      0   100%
hrp/api/__init__.py                       0      0   100%
hrp/api/platform.py                     196    196     0%   8-775
hrp/dashboard/__init__.py                 0      0   100%
hrp/dashboard/app.py                    438    438     0%   8-793
hrp/dashboard/pages/__init__.py           2      2     0%   3-5
hrp/dashboard/pages/data_health.py      155    155     0%   7-409
hrp/dashboard/pages/experiments.py      364    364     0%   7-853
hrp/dashboard/pages/home.py             203    203     0%   7-391
hrp/dashboard/pages/hypotheses.py       208    208     0%   11-449
hrp/data/__init__.py                      0      0   100%
hrp/data/db.py                          148     15    90%   61-63, 93-97, 130-134, 138, 166
hrp/data/ingestion/__init__.py            0      0   100%
hrp/data/ingestion/prices.py             82     82     0%   7-254
hrp/data/quality/__init__.py              0      0   100%
hrp/data/schema.py                       73     67     8%   149-243
hrp/data/sources/__init__.py              0      0   100%
hrp/data/sources/base.py                 23     23     0%   5-71
hrp/data/sources/yfinance_source.py      59     59     0%   7-171
hrp/mcp/__init__.py                       0      0   100%
hrp/ml/__init__.py                        0      0   100%
hrp/notifications/__init__.py             0      0   100%
hrp/research/__init__.py                  0      0   100%
hrp/research/backtest.py                 89     89     0%   5-234
hrp/research/benchmark.py                65     65     0%   5-188
hrp/research/config.py                   46     46     0%   5-78
hrp/research/hypothesis.py              165    165     0%   10-532
hrp/research/lineage.py                 153    153     0%   8-528
hrp/research/metrics.py                  78     78     0%   5-163
hrp/research/mlflow_utils.py             87     87     0%   5-189
hrp/risk/__init__.py                      0      0   100%
hrp/utils/__init__.py                     0      0   100%
hrp/utils/config.py                      58     58     0%   7-122
-------------------------------------------------------------------
TOTAL                                  2694   2553     5%
=========================== short test summary info ============================
FAILED tests/test_data/test_db.py::TestExecuteMethod::test_execute_returns_relation - assert 0 == 3
 +  where 0 = len([])
FAILED tests/test_data/test_db.py::TestExecuteMethod::test_execute_with_none_params - TypeError: 'NoneType' object is not subscriptable
FAILED tests/test_data/test_db.py::TestGetDB::test_get_db_returns_database_manager - TypeError: __new__() takes from 1 to 2 positional arguments but 3 were given
FAILED tests/test_data/test_db.py::TestGetDB::test_get_db_singleton - TypeError: __new__() takes from 1 to 2 positional arguments but 3 were given
FAILED tests/test_data/test_db.py::TestGetDB::test_get_db_with_explicit_path - TypeError: __new__() takes from 1 to 2 positional arguments but 3 were given
FAILED tests/test_data/test_db.py::TestGetDB::test_get_db_with_env_var - TypeError: __new__() takes from 1 to 2 positional arguments but 3 were given
FAILED tests/test_data/test_db.py::TestSchemaIntegration::test_create_tables - TypeError: unsupported operand type(s) for |: 'type' and 'NoneType'
FAILED tests/test_data/test_db.py::TestSchemaIntegration::test_verify_schema - TypeError: unsupported operand type(s) for |: 'type' and 'NoneType'
FAILED tests/test_data/test_db.py::TestSchemaIntegration::test_get_table_counts - TypeError: unsupported operand type(s) for |: 'type' and 'NoneType'
FAILED tests/test_data/test_db.py::TestSchemaIntegration::test_drop_all_tables - TypeError: unsupported operand type(s) for |: 'type' and 'NoneType'
======================== 10 failed, 43 passed in 0.90s =========================
